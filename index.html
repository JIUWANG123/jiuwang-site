
// 留言功能
    const form = document.getElementById('message-form');
    const display = document.getElementById('message-display');
    form.addEventListener('submit', e => {
      e.preventDefault();
      const name = document.getElementById('username').value.trim() || '匿名';
      const msg = document.getElementById('message').value.trim();
      if (!msg) return;
      const password = document.getElementById('delete-pass').value;
      fetch('/message', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, msg, password })
      }).then(() => {
        form.reset();
        loadMessages();
      });
    });

    function loadMessages() {
      fetch('/message')
        .then(res => res.json())
        .then(messages => {
          display.innerHTML = '';
          messages.forEach((entry, index) => {
            const div = document.createElement('div');
            div.className = 'message';
            const btn = isLoggedIn() ? `<button class="delete-button" data-index="${index}">删除</button>` : '';
            div.innerHTML = `<strong>${entry.name}</strong>：${entry.msg} ${btn}`;
            display.appendChild(div);
          });
        });
    }

    display.addEventListener('click', e => {
      if (e.target.classList.contains('delete-button')) {
        const index = e.target.getAttribute('data-index');
        const pw = prompt('请输入删除密码');
        fetch('/message/delete', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ index, pw })
        }).then(() => loadMessages());
      }
    });

    loadMessages();

// 提问箱逻辑
    const qForm = document.getElementById('question-form');
    const qDisplay = document.getElementById('question-display');

    qForm.addEventListener('submit', e => {
      e.preventDefault();
      const name = document.getElementById('q-name').value.trim() || '匿名';
      const question = document.getElementById('q-text').value.trim();
      const anonymous = document.getElementById('q-anonymous').checked;
      if (!question) return;
      fetch('/question', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, question, anonymous })
      }).then(() => {
        qForm.reset();
        loadQuestions();
      });
    });

    function loadQuestions() {
      fetch('/question')
        .then(res => res.json())
        .then(questions => {
          qDisplay.innerHTML = '';
          questions.forEach((entry, index) => {
            if (entry.hidden) return;
            const div = document.createElement('div');
            div.className = 'message';
            let html = `<strong>${entry.name}</strong>：${entry.question}`;
            if (entry.answer) html += `<div style="margin-top:0.3em;color:#aaa;"><em>答：</em>${entry.answer}</div>`;
            if (isLoggedIn()) {
              html += `<div style="margin-top:0.5em;">
                <button onclick="reply(${index})" class="reply-button">回复</button>
                <button onclick="hide(${index})" class="hide-button">隐藏</button>
              </div>`;
            }
            div.innerHTML = html;
            qDisplay.appendChild(div);
          });
        });
    }

    function reply(index) {
      const answer = prompt('输入你的回复：');
      const pw = prompt('请输入密码：');
      fetch('/question/reply', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ index, answer, pw })
      }).then(() => loadQuestions());
    }

    function hide(index) {
      const pw = prompt('请输入密码确认隐藏：');
      fetch('/question/hide', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ index, pw })
      }).then(() => loadQuestions());
    }

    loadQuestions();
